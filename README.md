# microstrap
Small "boostrap" made in python for micropython. It allows for fast prototyping of micropython apps running on embedded devices.

## How to download/install:

### Requirements:
```
pipenv python>=3.8 pyserial esptool make or pymake
```
### Installation process:
```
$ git clone https://github.com/krzesu0/microstrap
$ make init
$ pipenv install --three
```

## Usage:
### Hard flash
`hard_flash` is a process of reflashing devices whole flash memory to a new or another version of micropython's image. It simply uses esptool at `460800` baud to reflash image.
```
$ make hard_flash
or optionally
$ make hard_flash BAUD=115200 MICROPYTHON_IMAGE=esp8266-20210202-v1.14.bin
```

### Soft flash
`soft_flash` is used to upload files from inside of `src/` directory to device's flash memory. By default all files not mentioned in `.gitignore` are sent. Edit the `Makefile` to change it.

```
$ make soft_flash
...
Done! Have a nice day.
```
### Download from flash
`download_from_flash` downloads all the files from inside of the device to `dest/` directory.
```
$ make download_from_flash
Downloading file b'./boot.py'
...
```
## TODO's:
- [ ] Check for file content changes instead of remove-and-reupload.
- [x] Add comments to code.
- [x] Fix random `IOError`'s.


# Prototyping using microstrap

Inside of the `Makefile` change `COM` and `MICROPYTHON` variables to serial port location (for Windows eg. `COM3`, for UNIX eg. `/dev/ttyUSB0`) and micropython image (eg. `esp8266-20210202-v1.14.bin`) for your device respectively.

## Stubs
One way to boost your prototyping speed is to use intellisense inside your IDE of choice. Due to micropython implementation not all functions and methods are the same (`python` -> `micropython`), there are some new functions from nonexistant in default libs modules (`machine`, `uos`, `utime`), making it harder for you to develop. One way of getting back the linting is to create [stub files](https://www.python.org/dev/peps/pep-0561/) from firmware. Use [this page](https://github.com/Josverl/micropython-stubber) to get/create your `.py`/`.pyi` files and drop them inside of the typing folder. In VSCode with pylance it uses this directory by default.

### ESP8266
Put [this](https://raw.githubusercontent.com/Josverl/micropython-stubber/stub/esp8622/createstubs.py) inside of [this](https://python-minifier.com/) and then flash it to the device. Let it run and download files generated by the script back here. Move them to `typings/`. Aaand you are done.

### Other devices
¯\\\_(ツ)_/¯